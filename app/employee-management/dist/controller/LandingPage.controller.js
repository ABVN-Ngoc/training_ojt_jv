sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/core/Messaging","sap/m/MessageBox","sap/m/Text","sap/ui/model/json/JSONModel","sap/ui/model/ValidateException","./../model/models","./../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/i18n/ResourceBundle"],(e,t,a,s,o,r,l,i,n,m,c,d)=>{"use strict";return e.extend("employee-management.controller.LandingPage",{formatter:n,onInit:async function(){const e=this.getView();i.setGlobalModel(e);i.setInitVisibleControl(e);await i.getRole(e);await i.getDepartment(e);await i.getRoleLogin(e);const t=new sap.ui.model.odata.v4.ODataModel({operationMode:"Server",serviceUrl:"/odata/v4/ngoc123/",synchronizationMode:"None"});this.byId("table").bindItems({path:"EmployeeList>/Employees",parameters:{$expand:"role,department"},template:new sap.m.ColumnListItem({type:"Active",press:this.onItemPress.bind(this),cells:[new o({text:"{EmployeeList>firstName} {EmployeeList>lastName}"}),new sap.m.Text({text:"{EmployeeList>gender}"}),new sap.tnt.InfoLabel({text:"{EmployeeList>role/name}"}),new sap.m.Text({text:"{EmployeeList>department/name}"}),new sap.m.Text({text:"{EmployeeList>email}"}),new sap.m.Text({text:"{EmployeeList>dateOfBirth}"}),new sap.m.Text({text:"{EmployeeList>salary}"}),new sap.m.Button({id:"btn_Delete",press:this.onItemDelete.bind(this),icon:"sap-icon://decline",type:"Transparent",visible:"{RoleInfo>/admin}"})]})});e.setModel(t,"EmployeeList");this.modelI18n=d.create({url:"i18n/i18n.properties"});this.applyData=this.applyData.bind(this);this.fetchData=this.fetchData.bind(this);this.getFiltersWithValues=this.getFiltersWithValues.bind(this);this.oFilterBar=this.getView().byId("filterbar");this.oTableFilterbar=this.getView().byId("table");this.oFilterBar.registerFetchData(this.fetchData);this.oFilterBar.registerApplyData(this.applyData);this.oFilterBar.registerGetFiltersWithValues(this.getFiltersWithValues)},onPressHome:function(){const e=this.getView();this._clearDetailForm();this._clearForm();i._getModel(e,"VisibleControl").setProperty("/",{Home:true,List:false,InputForm:false,Detail:false})},onPressInput:function(){const e=this.getView();this._clearDetailForm();this._clearForm();i._getModel(e,"VisibleControl").setProperty("/",{Home:false,List:false,InputForm:true,Detail:false})},onPressCreate:async function(e){const a=this.getView();const o=i._getModel(a,"EmployeeInput").getData();const r=i._getModel(a,"EmployeeList");const l=this.modelI18n.getText("msgEmployeeCreate");const n=this.modelI18n.getText("msgFail");console.log("oDataModel",o);if(!this._validateForm()){return}const m={firstName:o.firstName,lastName:o.lastName,email:o.email,gender:o.gender,dateOfBirth:o.dateOfBirth,hireDate:o.hireDate,department:{ID:o.department?.ID},role:{ID:o.role?.ID}};console.log("oPayload",m);a.setBusy(true);try{const e=r.bindList("/Employees");await e.create(m);t.show(l);a.setBusy(false);await r.refresh();this._clearForm()}catch(e){a.setBusy(false);s.error(n,e)}i._getModel(a,"VisibleControl").setProperty("/",{Home:false,List:true,InputForm:false,Detail:false})},onPressList:function(){const e=this.getView();this._refreshTable();this._clearDetailForm();this._clearForm();e.getModel("VisibleControl").setProperty("/",{Home:false,List:true,InputForm:false,Detail:false})},onItemPress:function(e){const t=this.getView();const a=e.getParameter("listItem")||e.getSource();let s=a.getBindingContext("EmployeeList");const o=s.getObject();i._setModel(t,o,"EmployeeInfo");console.log("EmployeeInfo press",i._getModel(t,"EmployeeInfo"));i._getModel(t,"VisibleControl").setProperty("/",{Home:false,List:false,InputForm:false,Detail:true})},onItemDelete:async function(e){const a=e.getSource().getParent();const o=a.getBindingContext("EmployeeList");if(!o){t.show("No data found");return}s.confirm(this.modelI18n.getText("msgDelete"),{onClose:async e=>{if(e===s.Action.OK){try{if(typeof o.delete==="function"){await o.delete();t.show(this.modelI18n.getText("msgDeleteSuccess"))}else{s.error(this.modelI18n.getText("msgDeleteFail"))}}catch(e){s.error(this.modelI18n.getText("msgDeleteFail")+e.message)}}}})},_refreshTable:function(){const e=this.byId("table");const t=e.getBinding("rows");if(t){t.refresh(true)}},onPressCloseDetail:async function(){const e=this.getView();const t=i._getModel(e,"EmployeeList");await t.refresh();this._clearDetailForm();i._getModel(e,"VisibleControl").setProperty("/",{Home:false,List:true,InputForm:false,Detail:false})},onPressUpdate:async function(){const e=this.getView();const a=i._getModel(e,"EmployeeList");const o=JSON.parse(JSON.stringify(i._getModel(e,"EmployeeInfo").getData()));const r=this.modelI18n.getText("msgEmployeeUpdate");if(!this._validateDetailForm()){return}e.setBusy(true);if(!o||!o.ID){s.error(this.modelI18n.getText("msgEmployeeInvalid"));this._clearDetailForm();return}const l=`/Employees('${o.ID}')`;try{const n=a.bindContext(l);const m=await n.getBoundContext();if(!m){s.error(this.modelI18n.getText("msgEmployee404"));this._clearDetailForm();return}const c=o.role?.ID;const d=o.hireDate;let h=0;if(c&&d){const a=i._getModel(e,"Role").getData();const s=a.find(e=>e.ID===c);if(s&&s.baseSalary){const e=parseFloat(s.baseSalary)||0;const t=new Date(d);const a=new Date;const o=a.getFullYear()-t.getFullYear()-(a.getMonth()<t.getMonth()||a.getMonth()===t.getMonth()&&a.getDate()<t.getDate()?1:0);const r=o*1e3;h=e+r}else{t.show(this.modelI18n.getText("msgRole404"))}}else{t.show(this.modelI18n.getText("msgMissingRoleHireDate"))}console.log("iTotalSalary",h);console.log("266 oDataModel",o);m.setProperty("ID",o.ID);m.setProperty("firstName",o.firstName);t.show(r);e.setBusy(false);await a.refresh();this._clearDetailForm()}catch(t){e.setBusy(false);s.error(this.modelI18n.getText("msgError")+t.message)}i._getModel(e,"VisibleControl").setProperty("/",{Home:false,List:true,InputForm:false,Detail:false})},onPressCalSalary:function(e){const a=this.getView();const o=a.getModel("EmployeeInfo");const r=a.getModel("Role");const l=o.getData();const i=this.modelI18n.getText("msgFailCalSalary");const n=this.modelI18n.getText("msgMissingRoleHireDate");const m=this.modelI18n.getText("msgRole404");a.setBusy(true);try{const e=l.role?.ID;const s=l.hireDate;if(!e||!s){t.show(n);a.setBusy(false);return}const i=r.getData();const c=i.find(t=>t.ID===e);if(!c||!c.baseSalary){t.show(m);a.setBusy(false);return}const d=parseFloat(c.baseSalary)||0;const h=new Date(s);const f=new Date;const u=f.getFullYear()-h.getFullYear()-(f.getMonth()<h.getMonth()||f.getMonth()===h.getMonth()&&f.getDate()<h.getDate()?1:0);const g=u*1e3;const p=d+g;o.setProperty("/salary",p);t.show(`Salary calculated: $${p.toLocaleString()}`);a.setBusy(false)}catch(e){a.setBusy(false);s.error(i,e)}},onPressClose:async function(){const e=this.getView();const t=i._getModel(e,"EmployeeList");await t.refresh();this._clearForm();i._getModel(e,"VisibleControl").setProperty("/",{Home:true,List:false,InputForm:false,Detail:false})},onChangeEmail:function(e){const t=e.getSource();let a=t.getValue();const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!a.match(s)){t.setValueState("Error");t.setValueStateText("Input email not valid")}else{t.setValueState("Success");t.setValueStateText("Input email valid")}},onFilterChange:function(){this.updateTable()},updateTable:function(){this.oTableFilterbar.setShowOverlay(true)},onFilterSearch:function(){let e=[],t=[],a=[];const s=this.oFilterBar.getFilterGroupItems();for(let o=0;o<s.length;o++){const r=s[o];const l=r.getControl();const i=r.getName();if(i==="Department"){const a=l.getSelectedKeys();if(a.length===0){t=null}else{t=a.map(e=>new sap.ui.model.Filter({path:"department/ID",operator:c.EQ,value1:e}));e.push(new sap.ui.model.Filter(t,false))}}if(i==="Role"){const t=l.getSelectedKeys();if(t.length===0){a=null}else{a=t.map(e=>new sap.ui.model.Filter({path:"role/ID",operator:c.EQ,value1:e}));e.push(new sap.ui.model.Filter(a,false))}}}const o=this.oTableFilterbar.getBinding("items");if(e.length>0){o.filter(new sap.ui.model.Filter(e,true))}else{o.filter(null)}this.oTableFilterbar.setShowOverlay(false)},onClearFilters:function(){const e=this.oFilterBar.getFilterGroupItems();for(let t=0;t<e.length;t++){const a=e[t];const s=a.getControl();const o=a.getName();if(o==="Department"||o==="Role"){s.removeAllSelectedItems()}}},fetchData:function(){let e=this.oFilterBar.getAllFilterItems().reduce((e,t)=>{e.push({groupName:t.getGroupName(),fieldName:t.getName(),fieldData:t.getControl().getSelectedKeys()});return e},[]);return e},applyData:function(e){e.forEach(function(e){let t=this.oFilterBar.determineControlByName(e.fieldName,e.groupName);t.setSelectedKeys(e.fieldData)},this)},getFiltersWithValues:function(){const e=this.oFilterBar.getFilterGroupItems();let t=e.reduce((e,t)=>{let a=t.getControl();if(a&&a.getSelectedKeys&&a.getSelectedKeys().length>0){e.push(t)}return e},[]);return t},onSelectionChange:function(e){this.oFilterBar.fireFilterChange(e)},handleUploadComplete:function(e){const a=e.getParameter("files");if(!a||a.length===0){t.show("No file selected.");return}const s=["application/pdf","image/png","image/jpeg"];for(let e=0;e<a.length;e++){const o=a[e];const r=o.type;if(!s.includes(r)){t.show("Invalid file type: "+o.name);return}}this.byId("fileUploader").upload()},onSetLabelRole:function(){const e=this.getView().byId("table");const t=e.getItems();for(let e=0;e<t.length;e++){const a=t[e].getCells();const s=a[2];const o=s.getText();switch(o){case"HR":s.setColorScheme(1);break;case"Manager":s.setColorScheme(2);break;case"CEO":s.setColorScheme(3);break;case"Backend Developer":s.setColorScheme(9);break;case"Frontend Developer":s.setColorScheme(5);break;case"Full Stack Developer":s.setColorScheme(6);break;case"UI/UX Designer":s.setColorScheme(7);break;case"Project Manager":s.setColorScheme(8);break}}this._refreshTable()},_validateDetailForm:function(){const e=this.getView();const t=i._getModel(e,"EmployeeInfo").getData();const a=this.modelI18n.getText("msgFillin");let o="";const r={firstName:"d_iFirstName",lastName:"d_iLastName",email:"d_iEmail",gender:"d_ComboBoxGender",dateOfBirth:"d_DateofBirth",hireDate:"d_hireDate",department:"d_ComboBoxDepartment",role:"d_ComboBoxRole"};let l=true;const n=[];for(const[a,s]of Object.entries(r)){const r=e.byId(s);const i=t[a];const m=a==="department"||a==="role";const c=m?!i?.ID||i.ID.trim()==="":i===undefined||i===null||i==="";if(c){r.setValueState("Error");r.setValueStateText("This field is required");l=false;switch(a){case"firstName":o="First Name";break;case"lastName":o="Last Name";break;case"email":o="Email";break;case"gender":o="Gender";break;case"dateOfBirth":o="Date Of Birth";break;case"hireDate":o="Hire Date";break;case"department":o="Department";break;case"role":o="Role";break;default:break}n.push(`${o} is required`)}else{r.setValueState("None")}}const m=new Date(t.dateOfBirth);const c=new Date(t.hireDate);const d=e.byId("d_DateofBirth");const h=e.byId("d_hireDate");if(m>=c){d.setValueState("Error");h.setValueState("Error");d.setValueStateText("Date of birth must be before Hire date");h.setValueStateText("Hire date must be after Date of birth");n.push("Date of birth must be before Hire date");l=false}else{d.setValueState("None");h.setValueState("None")}if(!l){s.warning(n.join("\n"),{title:a})}return l},_validateForm:function(){const e=this.getView();const t=i._getModel(e,"EmployeeInput").getData();const a=this.modelI18n.getText("msgFillin");let o="";const r={firstName:"i_iFirstName",lastName:"i_iLastName",email:"i_iEmail",gender:"i_ComboBoxGender",dateOfBirth:"i_DateofBirth",hireDate:"i_hireDate",department:"i_ComboBoxDepartment",role:"i_ComboBoxRole"};let l=true;const n=[];for(const[a,s]of Object.entries(r)){const r=e.byId(s);const i=t[a];const m=a==="department"||a==="role";const c=m?!i?.ID||i.ID.trim()==="":i===undefined||i===null||i==="";if(c){r.setValueState("Error");r.setValueStateText("This field is required");l=false;switch(a){case"firstName":o="First Name";break;case"lastName":o="Last Name";break;case"email":o="Email";break;case"gender":o="Gender";break;case"dateOfBirth":o="Date Of Birth";break;case"hireDate":o="Hire Date";break;case"department":o="Department";break;case"role":o="Role";break;default:break}n.push(`${o} is required`)}else{r.setValueState("None")}}const m=new Date(t.dateOfBirth);const c=new Date(t.hireDate);const d=e.byId("i_DateofBirth");const h=e.byId("i_hireDate");if(m>=c){d.setValueState("Error");h.setValueState("Error");d.setValueStateText("Date of birth must be before Hire date");h.setValueStateText("Hire date must be after Date of birth");n.push("Date of birth must be before Hire date");l=false}else{d.setValueState("None");h.setValueState("None")}if(!l){s.warning(n.join("\n"),{title:a})}return l},_clearForm:function(){const e=this.getView();const t=i._getModel(e,"EmployeeInput");const a={ID:null,firstName:"",lastName:"",email:"",gender:"",dateOfBirth:null,hireDate:null,department:{ID:""},role:{ID:""}};t.setData(a);const s={firstName:"i_iFirstName",lastName:"i_iLastName",email:"i_iEmail",gender:"i_ComboBoxGender",dateOfBirth:"i_DateofBirth",hireDate:"i_hireDate",department:"i_ComboBoxDepartment",role:"i_ComboBoxRole"};for(const t of Object.values(s)){const a=e.byId(t);if(a){a.setValueState("None");a.setValue("")}}},_clearDetailForm:function(){const e=this.getView();const t=i._getModel(e,"EmployeeInput");const a={ID:null,firstName:"",lastName:"",email:"",gender:"",dateOfBirth:null,hireDate:null,department:{ID:""},role:{ID:""}};t.setData(a);const s={firstName:"d_iFirstName",lastName:"d_iLastName",email:"d_iEmail",gender:"d_ComboBoxGender",dateOfBirth:"d_DateofBirth",hireDate:"d_hireDate",department:"d_ComboBoxDepartment",role:"d_ComboBoxRole"};for(const t of Object.values(s)){const a=e.byId(t);if(a){a.setValueState("None");a.setValue("")}}},_formatToDateOnly:function(e){if(!isNaN(e)){let e=(new Date).toISOString().slice(0,10);return e}else{console.warn("Invalid date:",e);return null}}})});
//# sourceMappingURL=LandingPage.controller.js.map